<!DOCTYPE html>

{% extends 'base.html' %}
{% block content %}



<head>
    <style type="text/css">
        html, body { height: 100%; margin: 0; padding: 0; }
        #map { height: 100%; }
    </style>
</head>
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src= "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.1/Chart.js"></script>
<body>

Property ID: {{  address_params.property_id }}<br>
Address: {{  address_params.address }}<br>
<br>
<br>
<br>
<br>
Sales Details:
<div id='sale_history' value = "{{ sale_history }}">
    <!-- <a href="{{ url_for('sales_trend_data', sales_trend=sale_history) }}">Send my_value</a> -->

        <ul>
            {% if sale_history != 0 %}
                {% for sale in sale_history %}
                <li>
                    Sale Date: {{  sale[0]  }}   Price: ${{  sale[1]  }}
                </li>
                {% endfor %}
            {% else %}
                No sales data available for this address.

            {% endif %}
        </ul>
</div>
<script>
    "use strict";
//     function loadTrends() {
//         // $(document).ready(
//         let sales_trend_data = document.getElementById("#sale_history");
//         console.log("hello");
//         console.log(sales_trend_data);
   
//         let data = {"sales_data" : sales_trend_data}
//         $.get('/sales-trend.json', 
//             data)
//         function() {
//         console.log("success")
//     };
// }
window.onload = function (){
   let sales_trend_data = document.getElementById("sale_history").getAttribute("value");
    console.log(sales_trend_data);
    console.log("hello"); 
    let data = {"sales_data" : sales_trend_data}
        $.get('/sales-trend.json', 
            data)
        
        console.log("success")
}

 
</script>

<div class="melon-chart">
    <!-- <a href="/sales-trend.json"></a> -->
  <canvas id="lineChart"></canvas>
  <div id="lineLegend" class="chart-legend"></div>
</div>
<div>
    <button type="button", id='saved-property', value = "{{ address_params }}"> Save this property
</div>
<script>
    "use strict";

    function handleSave(evt) {
        let address_params = document.getElementById("saved-property").value;
        $.post('/search', {save_type : "address",save_data: address_params}, function (data) {
            $('#saved-property').text('Property Saved.');
            $('#saved-property').attr('disabled', true);
            console.log(data);
        });
    }

    $('#saved-property').on('click', handleSave);

</script>

<input id="propertymap" value="{{ address_params }}" hidden>
<input id="saleshistory" value="{{ sale_history }}" hidden>
<br>
<br>
<div id="map"></div>

    <!-- Google maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places"></script>

    <!-- what it looks like with a key -->
<!-- <script async defer
//       src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE&callback=initMap">
</script> -->

    <script src="../static/googlemaps.js"></script>
    <script src="../static/sales_trend_chart.js"></script>

</body>
{% endblock %}


